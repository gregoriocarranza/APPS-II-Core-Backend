asyncapi: "2.6.0"
info:
  title: Core Event Bus
  version: "0.1.0"
  description: |
    Bus de eventos con RabbitMQ usando exchanges tipo `topic`.
    - El **exchange** actúa como router (no es el evento).
    - Los **eventos** se publican con `routingKey` (p.ej. `user.created`).
    - Cada **microservicio** tiene **su propia cola** y la **bindea** al exchange con la `bindingKey` que necesita (p.ej. `user.*`).
    - Entrega **at-least-once**; se recomienda idempotencia en consumidores.
    - Envelope estilo **CloudEvents 1.0**: (specversion, id, source, type, subject, time, data).

defaultContentType: application/json

tags:
  - name: Users
    description: Eventos relacionados a usuarios
  - name: Inscripciones
    description: Eventos del dominio de inscripciones
  - name: Publish
    description: Operaciones de publicacion
  - name: Subscribe
    description: Operaciones de suscripcion
  - name: Materias
    description: Eventos relacionados a materias
  - name: Correlativas
    description: Eventos de correlatividades de materias
  - name: DocentesMateria
    description: Eventos sobre asignaciones docente-materia

servers:
  rabbitmqLocal:
    url: amqp://guest:guest@localhost:5672
    protocol: amqp
    protocolVersion: "0-9-1"
    description: RabbitMQ local (desarrollo)

channels:
  user.created:
    description: Evento emitido por BackOffice cuando se crea un usuario.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: user.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    subscribe:
      tags:
        - name: Users
        - name: Subscribe
      summary: User Creation.
      operationId: subscribeUserCreatedV1
      bindings:
        amqp:
          ack: true
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/UserCreatedV1"
  inscripciones.created:
    description: Evento emitido cuando se crea una inscripción. Evento producido por CORE, consumido por Alumnos (entre otros).
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: inscripciones.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Inscripciones
      summary: Registration Creation.
      operationId: publishInscripcionCreatedV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/InscripcionCreatedV1"
  inscripciones.delete:
    description: Evento emitido cuando se elimina una inscripción. Evento producido por CORE, consumido por Alumnos (entre otros)
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: inscripciones.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Inscripciones
      summary: Registration Deletion.
      operationId: publishInscripcionDeleteV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/InscripcionDeletedV1"
  materias.created:
    description: Evento emitido cuando se crea una materia. Evento producido por CORE, consumido por Docentes (entre otros).
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: materia.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Materias
      summary: Materia Creation.
      operationId: publishMateriaCreatedV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/MateriaCreatedV1"
  materias.updated:
    description: Evento emitido cuando se actualiza una materia. Evento producido por CORE, consumido por Docentes (entre otros).
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: materia.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Materias
      summary: Materia updated.
      operationId: publishMateriaUpdatedV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/MateriaCreatedV1"
  materias.delete:
    description: Evento emitido cuando se elimina una materia, Evento producido por CORE, consumido por Docentes (entre otros).
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: materias.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Materias
      summary: Materia Deletion.
      operationId: publishMateriaDeleteV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/MateriaDeletedV1"
  correlativas.created:
    description: Evento emitido cuando se crea una correlatividad entre materias.  Evento producido por CORE, consumido por Varios.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: correlativas.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Correlativas
      summary: Correlativa Creation.
      operationId: publishCorrelativaCreatedV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/CorrelativaCreatedV1"
  correlativas.updated:
    description: Evento emitido cuando se actualiza una correlatividad entre materias.  Evento producido por CORE, consumido por Varios.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: correlativas.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Correlativas
      summary: Correlativa updated.
      operationId: publishCorrelativaUpdatedV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/CorrelativaCreatedV1"
  correlativas.delete:
    description: Evento emitido cuando se elimina una correlatividad entre materias. Evento producido por CORE, consumido por Varios.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: correlativas.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Correlativas
      summary: Correlativa Deletion.
      operationId: publishCorrelativaDeleteV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/CorrelativaDeletedV1"
  docentes_materia.created:
    description: Evento emitido cuando se asigna un docente a una materia. Evento producido por CORE, consumido por Docentes.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: docentes_materia.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: DocentesMateria
      summary: Docente Materia Creation.
      operationId: publishDocenteMateriaCreatedV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/DocenteMateriaCreatedV1"
  docentes_materia.delete:
    description: Evento emitido cuando se elimina la asignacion de un docente a una materia. Evento producido por CORE, consumido por Docentes.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: docentes_materia.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: DocentesMateria
      summary: Docente Materia Deletion.
      operationId: publishDocenteMateriaDeleteV1
      bindings:
        amqp:
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/DocenteMateriaDeletedV1"
  wallet.created:
    description: Evento emitido cuando se crea una wallet. Producido por CORE, consumido por docentes, alumnos, tienda, comedor.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: wallets.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Wallets
      summary: Wallet Creation.
      operationId: publishWalletCreatedV1
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/WalletCreatedV1"
  wallet.amount.updated:
    description: Se actualiza el balance de una wallet (por movimientos/ajustes). Producido por CORE.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: wallets.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Wallets
      summary: Wallet Balance Updated.
      operationId: publishWalletAmountUpdatedV1
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/WalletAmountUpdatedV1"
  transfer.created:
    description: Se inicia una transferencia entre wallets. Producido por CORE.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: transfers.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Transfers
      summary: Transfer Created.
      operationId: publishTransferCreatedV1
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/TransferCreatedV1"
  transfer.canceled:
    description: Una transferencia iniciada se cancela. Producido por CORE.
    bindings:
      amqp:
        is: routingKey
        exchange:
          name: transfers.events
          type: topic
          durable: true
          autoDelete: false
        bindingVersion: "0.2.0"
    publish:
      tags:
        - name: Publish
        - name: Transfers
      summary: Transfer Canceled.
      operationId: publishTransferCanceledV1
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
      message:
        $ref: "#/components/messages/TransferCanceledV1"

components:
  schemas:
    CloudEventBase:
      type: object
      required:
        - eventId
        - eventType
        - occurredAt
        - emittedAt
        - sourceModule
        - tenant
        - actor
        - payload
        - version
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador único del evento.
        eventType:
          type: string
          description: Tipo lógico del evento (sin versión), p. ej. 'UserCreated', 'GradePosted'.
        occurredAt:
          type: string
          format: date-time
          description: Momento en que ocurrió el hecho de negocio (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento en que el evento fue emitido al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del módulo/productor, p. ej. 'BackOffice', 'PortalDocente'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        payload:
          type: object
          description: Carga útil específica del evento (schema propio por tipo).
        version:
          type: string
          example: "1.0"
          description: Versión del contrato del envelope.

    TenantRef:
      type: object
      required: [campusId, orgId]
      properties:
        campusId:
          type: string
          description: Identificador del campus/locación del tenant.
        orgId:
          type: string
          description: Identificador de la organización del tenant.

    ActorRef:
      type: object
      required: [userId, role]
      properties:
        userId:
          type: string
          description: Identificador del actor que ejecutó la acción.
        role:
          type: string
          description: Rol del actor, p. ej. 'DOCENTE', 'ADMIN', etc.

    UserCreatedDataV1:
      type: object
      description: Envelope + payload específico del evento UserCreated v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId: { type: string, format: uuid }
        eventType: { type: string, const: UserCreated }
        occurredAt: { type: string, format: date-time }
        emittedAt: { type: string, format: date-time }
        sourceModule: { type: string }
        tenant: { $ref: "#/components/schemas/TenantRef" }
        actor: { $ref: "#/components/schemas/ActorRef" }
        version: { type: string, example: "1.0" }
        payload:
          type: object
          required: [uuid, name, email, created_at]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador único del usuario.
            name:
              type: string
              description: Nombre completo del usuario.
            email:
              type: string
              format: email
              description: Email único del usuario.
            created_at:
              type: string
              format: date-time
              description: Fecha de creación en ISO 8601.

    InscripcionCreatedDataV1:
      type: object
      description: Envelope + payload específico del evento InscripcionCreated v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador único del evento.
        eventType:
          type: string
          description: Tipo lógico del evento (sin versión).
          const: InscripcionCreated
        occurredAt:
          type: string
          format: date-time
          description: Momento del hecho de negocio (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento de emisión al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del módulo/productor, p. ej. 'BackOffice', 'PortalAlumno'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        version:
          type: string
          example: "1.0"
          description: Versión del contrato del envelope.
        payload:
          type: object
          description: Datos de la inscripción creada.
          required: [uuid, uuid_curso, uuid_alumno, estado, rol, created_at]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador único de la inscripción.
            uuid_curso:
              type: string
              format: uuid
              description: Identificador del curso asociado.
            uuid_alumno:
              type: string
              format: uuid
              description: Identificador del alumno asociado.
            estado:
              type: string
              description: Estado de la inscripción (ej. pendiente, confirmada, cancelada).
            rol:
              type: string
              description: Rol de la persona en el curso (ej. titular, adjunto, ayudante, alumno).
            created_at:
              type: string
              format: date-time
              description: Fecha de creación en ISO 8601.
    InscripcionDeletedDataV1:
      type: object
      description: Envelope + payload específico del evento InscripcionDeleted v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador único del evento.
        eventType:
          type: string
          const: InscripcionDeleted
          description: Tipo lógico del evento (sin versión).
        occurredAt:
          type: string
          format: date-time
          description: Momento del borrado lógico/físico (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento de emisión al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del módulo/productor, p. ej. 'BackOffice', 'PortalAlumno'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        version:
          type: string
          example: "1.0"
          description: Versión del contrato del envelope.
        payload:
          type: object
          description: Datos mínimos de la inscripción eliminada.
          required: [uuid, uuid_curso, uuid_alumno, estado, deleted_at]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador único de la inscripción.
            uuid_curso:
              type: string
              format: uuid
              description: Identificador del curso asociado.
            uuid_alumno:
              type: string
              format: uuid
              description: Identificador del alumno asociado.
            deleted_at:
              type: string
              format: date-time
              description: Fecha de eliminación en ISO 8601.
            estado:
              type: string
              description: Estado de la inscripción (ej. pendiente, confirmada, cancelada).
            reason:
              type: string
              description: Motivo de la eliminación (opcional).
    MateriaCreatedDataV1:
      type: object
      description: Envelope + payload especifico del evento MateriaCreated v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador unico del evento.
        eventType:
          type: string
          const: MateriaCreated
          description: Tipo logico del evento (sin version).
        occurredAt:
          type: string
          format: date-time
          description: Momento del hecho de negocio (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento de emision al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del modulo/productor, p. ej. 'BackOffice', 'PortalAlumno'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        version:
          type: string
          example: "1.0"
          description: Version del contrato del envelope.
        payload:
          type: object
          description: Datos de la materia creada.
          required: [uuid, nombre]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador unico de la materia.
            nombre:
              type: string
              description: Nombre unico de la materia.
    MateriaDeletedDataV1:
      type: object
      description: Envelope + payload especifico del evento MateriaDeleted v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador unico del evento.
        eventType:
          type: string
          const: MateriaDeleted
          description: Tipo logico del evento (sin version).
        occurredAt:
          type: string
          format: date-time
          description: Momento del borrado logico/fisico (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento de emision al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del modulo/productor, p. ej. 'BackOffice', 'PortalAlumno'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        version:
          type: string
          example: "1.0"
          description: Version del contrato del envelope.
        payload:
          type: object
          description: Datos minimos de la materia eliminada.
          required: [uuid, deleted_at]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador unico de la materia.
            nombre:
              type: string
              description: Nombre de la materia al momento del borrado.
            deleted_at:
              type: string
              format: date-time
              description: Fecha de eliminacion en ISO 8601.
            reason:
              type: string
              description: Motivo de la eliminacion (opcional).
    CorrelativaCreatedDataV1:
      type: object
      description: Envelope + payload especifico del evento CorrelativaCreated v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador unico del evento.
        eventType:
          type: string
          const: CorrelativaCreated
          description: Tipo logico del evento (sin version).
        occurredAt:
          type: string
          format: date-time
          description: Momento del hecho de negocio (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento de emision al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del modulo/productor, p. ej. 'BackOffice', 'PortalAlumno'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        version:
          type: string
          example: "1.0"
          description: Version del contrato del envelope.
        payload:
          type: object
          description: Datos de la correlatividad creada.
          required: [uuid, uuid_materia, uuid_materia_correlativa]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador unico de la correlatividad.
            uuid_materia:
              type: string
              format: uuid
              description: Identificador de la materia base.
            uuid_materia_correlativa:
              type: string
              format: uuid
              description: Identificador de la materia correlativa.
    CorrelativaDeletedDataV1:
      type: object
      description: Envelope + payload especifico del evento CorrelativaDeleted v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador unico del evento.
        eventType:
          type: string
          const: CorrelativaDeleted
          description: Tipo logico del evento (sin version).
        occurredAt:
          type: string
          format: date-time
          description: Momento del borrado logico/fisico (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento de emision al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del modulo/productor, p. ej. 'BackOffice', 'PortalAlumno'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        version:
          type: string
          example: "1.0"
          description: Version del contrato del envelope.
        payload:
          type: object
          description: Datos minimos de la correlatividad eliminada.
          required: [uuid, uuid_materia, uuid_materia_correlativa, deleted_at]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador unico de la correlatividad.
            uuid_materia:
              type: string
              format: uuid
              description: Identificador de la materia base.
            uuid_materia_correlativa:
              type: string
              format: uuid
              description: Identificador de la materia correlativa.
            deleted_at:
              type: string
              format: date-time
              description: Fecha de eliminacion en ISO 8601.
            reason:
              type: string
              description: Motivo de la eliminacion (opcional).
    DocenteMateriaCreatedDataV1:
      type: object
      description: Envelope + payload especifico del evento DocenteMateriaCreated v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador unico del evento.
        eventType:
          type: string
          const: DocenteMateriaCreated
          description: Tipo logico del evento (sin version).
        occurredAt:
          type: string
          format: date-time
          description: Momento del hecho de negocio (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento de emision al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del modulo/productor, p. ej. 'BackOffice', 'PortalAlumno'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        version:
          type: string
          example: "1.0"
          description: Version del contrato del envelope.
        payload:
          type: object
          description: Datos de la asignacion docente-materia creada.
          required: [uuid, uuid_docente, uuid_materia]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador unico de la asignacion.
            uuid_docente:
              type: string
              format: uuid
              description: Identificador del docente.
            uuid_materia:
              type: string
              format: uuid
              description: Identificador de la materia.
    DocenteMateriaDeletedDataV1:
      type: object
      description: Envelope + payload especifico del evento DocenteMateriaDeleted v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId:
          type: string
          format: uuid
          description: Identificador unico del evento.
        eventType:
          type: string
          const: DocenteMateriaDeleted
          description: Tipo logico del evento (sin version).
        occurredAt:
          type: string
          format: date-time
          description: Momento del borrado logico/fisico (ISO-8601, UTC).
        emittedAt:
          type: string
          format: date-time
          description: Momento de emision al bus (ISO-8601, UTC).
        sourceModule:
          type: string
          description: Nombre del modulo/productor, p. ej. 'BackOffice', 'PortalAlumno'.
        tenant:
          $ref: "#/components/schemas/TenantRef"
        actor:
          $ref: "#/components/schemas/ActorRef"
        version:
          type: string
          example: "1.0"
          description: Version del contrato del envelope.
        payload:
          type: object
          description: Datos minimos de la asignacion docente-materia eliminada.
          required: [uuid, uuid_docente, uuid_materia, deleted_at]
          properties:
            uuid:
              type: string
              format: uuid
              description: Identificador unico de la asignacion.
            uuid_docente:
              type: string
              format: uuid
              description: Identificador del docente.
            uuid_materia:
              type: string
              format: uuid
              description: Identificador de la materia.
            deleted_at:
              type: string
              format: date-time
              description: Fecha de eliminacion en ISO 8601.
            reason:
              type: string
              description: Motivo de la eliminacion (opcional).
    WalletCreatedDataV1:
      type: object
      description: Envelope + payload para WalletCreated v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId: { type: string, format: uuid }
        eventType: { type: string, const: WalletCreated }
        occurredAt: { type: string, format: date-time }
        emittedAt: { type: string, format: date-time }
        sourceModule: { type: string }
        tenant: { $ref: "#/components/schemas/TenantRef" }
        actor: { $ref: "#/components/schemas/ActorRef" }
        version: { type: string }
        payload:
          type: object
          required: [uuid, user_id, currency, status, created_at]
          properties:
            uuid:
              {
                type: string,
                format: uuid,
                description: Identificador de la wallet,
              }
            user_id:
              {
                type: string,
                format: uuid,
                description: Usuario dueño de la wallet,
              }
            currency: { type: string, minLength: 3, maxLength: 3 }
            status: { type: string, description: Estado lógico de la wallet }
            created_at: { type: string, format: date-time }
    WalletAmountUpdatedDataV1:
      type: object
      description: Envelope + payload para WalletAmountUpdated v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId: { type: string, format: uuid }
        eventType: { type: string, const: WalletAmountUpdated }
        occurredAt: { type: string, format: date-time }
        emittedAt: { type: string, format: date-time }
        sourceModule: { type: string }
        tenant: { $ref: "#/components/schemas/TenantRef" }
        actor: { $ref: "#/components/schemas/ActorRef" }
        version: { type: string }
        payload:
          type: object
          required:
            [wallet_uuid, previous_amount, new_amount, currency, posted_at]
          properties:
            wallet_uuid: { type: string, format: uuid }
            previous_amount:
              { type: string, description: Monto anterior (decimal string) }
            new_amount:
              { type: string, description: Monto nuevo (decimal string) }
            currency: { type: string, minLength: 3, maxLength: 3 }
            reason:
              {
                type: string,
                description: Motivo del cambio (p.ej. DEBIT_TRANSACTION - CREDIT_TRANSACTION - ADJUSTMENT),
              }
            transaction_uuid: { type: string, format: uuid, nullable: true }
            posted_at: { type: string, format: date-time }
    TransferCreatedDataV1:
      type: object
      description: Envelope + payload para TransferCreated v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId: { type: string, format: uuid }
        eventType: { type: string, const: TransferCreated }
        occurredAt: { type: string, format: date-time }
        emittedAt: { type: string, format: date-time }
        sourceModule: { type: string }
        tenant: { $ref: "#/components/schemas/TenantRef" }
        actor: { $ref: "#/components/schemas/ActorRef" }
        version: { type: string }
        payload:
          type: object
          required:
            [
              transfer_uuid,
              from_wallet_uuid,
              to_wallet_uuid,
              amount,
              currency,
              status,
              created_at,
            ]
          properties:
            transfer_uuid: { type: string, format: uuid }
            from_wallet_uuid: { type: string, format: uuid }
            to_wallet_uuid: { type: string, format: uuid }
            amount:
              { type: string, description: Monto transferido (decimal string) }
            currency: { type: string, minLength: 3, maxLength: 3 }
            description: { type: string, nullable: true }
            status:
              {
                type: string,
                description: Estado inicial (PENDING - PROCESSING - COMPLETED - CANCELED),
              }
            created_at: { type: string, format: date-time }
    TransferCanceledDataV1:
      type: object
      description: Envelope + payload para TransferCanceled v1.
      required:
        [
          eventId,
          eventType,
          occurredAt,
          emittedAt,
          sourceModule,
          tenant,
          actor,
          payload,
          version,
        ]
      properties:
        eventId: { type: string, format: uuid }
        eventType: { type: string, const: TransferCanceled }
        occurredAt: { type: string, format: date-time }
        emittedAt: { type: string, format: date-time }
        sourceModule: { type: string }
        tenant: { $ref: "#/components/schemas/TenantRef" }
        actor: { $ref: "#/components/schemas/ActorRef" }
        version: { type: string }
        payload:
          type: object
          required:
            [
              transfer_uuid,
              from_wallet_uuid,
              to_wallet_uuid,
              amount,
              currency,
              status,
              canceled_at,
            ]
          properties:
            transfer_uuid: { type: string, format: uuid }
            from_wallet_uuid: { type: string, format: uuid }
            to_wallet_uuid: { type: string, format: uuid }
            amount: { type: string }
            currency: { type: string, minLength: 3, maxLength: 3 }
            reason: { type: string, description: Causa de cancelación }
            canceled_at: { type: string, format: date-time }
            status: { type: string, const: CANCELED }
  messages:
    UserCreatedV1:
      name: UserCreatedV1
      title: User Created v1
      summary: Notifica que un usuario fue creado en BackOffice.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/UserCreatedDataV1"
        example:
          eventId: "c0a8012e-1a2b-4f3d-9c0e-123456789abc"
          eventType: "UserCreated"
          occurredAt: "2025-09-16T19:45:00Z"
          emittedAt: "2025-09-16T19:45:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "u123", role: "ADMIN" }
          payload:
            uuid: "c0a8012e-1a2b-4f3d-9c0e-123456789abc"
            name: "Juan Pérez"
            email: "juan.perez@example.com"
            created_at: "2025-09-16T19:45:00Z"
          version: "1.0"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    InscripcionCreatedV1:
      name: InscripcionCreatedV1
      title: Inscripción Creada v1
      summary: Notifica que se creó una inscripción.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/InscripcionCreatedDataV1"
        example:
          eventId: "6f1a4b2c-9b2e-4f0d-8c0a-1234567890ab"
          eventType: "InscripcionCreated"
          occurredAt: "2025-09-16T19:55:00Z"
          emittedAt: "2025-09-16T19:55:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "admin-001", role: "ADMIN" }
          version: "1.0"
          payload:
            uuid: "2a3a5e7c-1c8b-4e25-9a7e-abcdefabcdef"
            uuid_curso: "b9f1d2c3-4a5b-6c7d-8e9f-0123456789ab"
            uuid_alumno: "0a1b2c3d-4e5f-6789-abcd-ef0123456789"
            estado: "pendiente"
            rol: "alumno"
            created_at: "2025-09-16T19:55:00Z"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    InscripcionDeletedV1:
      name: InscripcionDeletedV1
      title: Inscripción Eliminada v1
      summary: Notifica que se eliminó una inscripción.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/InscripcionDeletedDataV1"
        example:
          eventId: "e2a9e8e4-4b07-4d9f-9ab1-0d6a9b1f23cd"
          eventType: "InscripcionDeleted"
          occurredAt: "2025-09-16T20:05:00Z"
          emittedAt: "2025-09-16T20:05:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "admin-001", role: "ADMIN" }
          version: "1.0"
          payload:
            uuid: "9f2b5c7d-1a23-4b56-8c9d-0123456789ab"
            uuid_curso: "b9f1d2c3-4a5b-6c7d-8e9f-0123456789ab"
            uuid_alumno: "0a1b2c3d-4e5f-6789-abcd-ef0123456789"
            deleted_at: "2025-09-16T20:05:00Z"
            reason: "Solicitud del alumno"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    MateriaCreatedV1:
      name: MateriaCreatedV1
      title: Materia Created v1
      summary: Notifica que se creo una materia.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/MateriaCreatedDataV1"
        example:
          eventId: "3a9f1b2c-4d5e-678f-9012-abcdefabcdef"
          eventType: "MateriaCreated"
          occurredAt: "2025-09-16T21:00:00Z"
          emittedAt: "2025-09-16T21:00:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "admin-001", role: "ADMIN" }
          version: "1.0"
          payload:
            uuid: "7b6c5d4e-3f2a-1b0c-9d8e-76543210abcd"
            nombre: "Analisis Matematico I"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    MateriaDeletedV1:
      name: MateriaDeletedV1
      title: Materia Deleted v1
      summary: Notifica que se elimino una materia.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/MateriaDeletedDataV1"
        example:
          eventId: "9c8d7e6f-5a4b-3210-fedc-ba9876543210"
          eventType: "MateriaDeleted"
          occurredAt: "2025-09-17T10:15:00Z"
          emittedAt: "2025-09-17T10:15:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "admin-002", role: "ADMIN" }
          version: "1.0"
          payload:
            uuid: "7b6c5d4e-3f2a-1b0c-9d8e-76543210abcd"
            nombre: "Analisis Matematico I"
            deleted_at: "2025-09-17T10:15:00Z"
            reason: "Reemplazo por nuevo plan"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    CorrelativaCreatedV1:
      name: CorrelativaCreatedV1
      title: Correlativa Created v1
      summary: Notifica que se creo una correlatividad entre materias.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/CorrelativaCreatedDataV1"
        example:
          eventId: "1f2e3d4c-5b6a-7980-91ab-cdefabcdef12"
          eventType: "CorrelativaCreated"
          occurredAt: "2025-09-18T09:00:00Z"
          emittedAt: "2025-09-18T09:00:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "admin-003", role: "ADMIN" }
          version: "1.0"
          payload:
            uuid: "abcdef12-3456-7890-abcd-ef1234567890"
            uuid_materia: "7b6c5d4e-3f2a-1b0c-9d8e-76543210abcd"
            uuid_materia_correlativa: "01234567-89ab-cdef-0123-456789abcdef"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    CorrelativaDeletedV1:
      name: CorrelativaDeletedV1
      title: Correlativa Deleted v1
      summary: Notifica que se elimino una correlatividad entre materias.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/CorrelativaDeletedDataV1"
        example:
          eventId: "210fedcb-a987-6543-210f-edcba9876543"
          eventType: "CorrelativaDeleted"
          occurredAt: "2025-09-18T12:30:00Z"
          emittedAt: "2025-09-18T12:30:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "admin-003", role: "ADMIN" }
          version: "1.0"
          payload:
            uuid: "abcdef12-3456-7890-abcd-ef1234567890"
            uuid_materia: "7b6c5d4e-3f2a-1b0c-9d8e-76543210abcd"
            uuid_materia_correlativa: "01234567-89ab-cdef-0123-456789abcdef"
            deleted_at: "2025-09-18T12:30:00Z"
            reason: "Actualizacion de plan de estudios"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    DocenteMateriaCreatedV1:
      name: DocenteMateriaCreatedV1
      title: Docente Materia Created v1
      summary: Notifica que se creo una asignacion docente-materia.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/DocenteMateriaCreatedDataV1"
        example:
          eventId: "fedcba98-7654-3210-fedc-ba9876543210"
          eventType: "DocenteMateriaCreated"
          occurredAt: "2025-09-19T08:45:00Z"
          emittedAt: "2025-09-19T08:45:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "admin-004", role: "ADMIN" }
          version: "1.0"
          payload:
            uuid: "0fedcba9-8765-4321-0fed-cba987654321"
            uuid_docente: "12345678-90ab-cdef-1234-567890abcdef"
            uuid_materia: "7b6c5d4e-3f2a-1b0c-9d8e-76543210abcd"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    DocenteMateriaDeletedV1:
      name: DocenteMateriaDeletedV1
      title: Docente Materia Deleted v1
      summary: Notifica que se elimino una asignacion docente-materia.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/DocenteMateriaDeletedDataV1"
        example:
          eventId: "0abc1234-def5-6789-0abc-1234def56789"
          eventType: "DocenteMateriaDeleted"
          occurredAt: "2025-09-19T11:00:00Z"
          emittedAt: "2025-09-19T11:00:01Z"
          sourceModule: "BackOffice"
          tenant: { campusId: "BA", orgId: "UNI" }
          actor: { userId: "admin-004", role: "ADMIN" }
          version: "1.0"
          payload:
            uuid: "0fedcba9-8765-4321-0fed-cba987654321"
            uuid_docente: "12345678-90ab-cdef-1234-567890abcdef"
            uuid_materia: "7b6c5d4e-3f2a-1b0c-9d8e-76543210abcd"
            deleted_at: "2025-09-19T11:00:00Z"
            reason: "Fin de contrato"
      bindings:
        amqp:
          deliveryMode: 2
          mandatory: false
          bindingVersion: "0.2.0"
    WalletCreatedV1:
      name: WalletCreatedV1
      title: Wallet Created v1
      summary: Notifica que se creó una wallet.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/WalletCreatedDataV1"
        example:
          eventId: "6d6d6f7a-6a6a-4aaa-9b9b-111111111111"
          eventType: "WalletCreated"
          occurredAt: "2025-09-22T10:00:00Z"
          emittedAt: "2025-09-22T10:00:01Z"
          sourceModule: "CORE"
          tenant: { campusId: "AR", orgId: "FIN" }
          actor: { userId: "system", role: "SERVICE" }
          version: "1.0"
          payload:
            uuid: "11111111-2222-3333-4444-555555555555"
            user_id: "99999999-aaaa-bbbb-cccc-dddddddddddd"
            currency: "ARS"
            status: "ACTIVE"
            created_at: "2025-09-22T10:00:00Z"
    WalletAmountUpdatedV1:
      name: WalletAmountUpdatedV1
      title: Wallet Amount Updated v1
      summary: Notifica cambio de balance en una wallet.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/WalletAmountUpdatedDataV1"
        example:
          eventId: "77777777-8888-9999-aaaa-bbbbbbbbbbbb"
          eventType: "WalletAmountUpdated"
          occurredAt: "2025-09-22T10:05:00Z"
          emittedAt: "2025-09-22T10:05:01Z"
          sourceModule: "CORE"
          tenant: { campusId: "AR", orgId: "FIN" }
          actor: { userId: "system", role: "SERVICE" }
          version: "1.0"
          payload:
            wallet_uuid: "11111111-2222-3333-4444-555555555555"
            previous_amount: "150000.00"
            new_amount: "149500.00"
            currency: "ARS"
            reason: "DEBIT_TRANSACTION"
            transaction_uuid: "aaaa1111-bbbb-2222-cccc-333333333333"
            posted_at: "2025-09-22T10:05:00Z"
    TransferCreatedV1:
      name: TransferCreatedV1
      title: Transfer Created v1
      summary: Notifica que se inició una transferencia entre wallets.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/TransferCreatedDataV1"
        example:
          eventId: "12121212-3434-5656-7878-909090909090"
          eventType: "TransferCreated"
          occurredAt: "2025-09-22T10:10:00Z"
          emittedAt: "2025-09-22T10:10:01Z"
          sourceModule: "CORE"
          tenant: { campusId: "AR", orgId: "FIN" }
          actor: { userId: "system", role: "SERVICE" }
          version: "1.0"
          payload:
            transfer_uuid: "9999aaaa-bbbb-cccc-dddd-eeeeeeeeeeee"
            from_wallet_uuid: "11111111-2222-3333-4444-555555555555"
            to_wallet_uuid: "66666666-7777-8888-9999-000000000000"
            amount: "500.00"
            currency: "ARS"
            description: "Envio a Juan"
            status: "PENDING"
            created_at: "2025-09-22T10:10:00Z"
    TransferCanceledV1:
      name: TransferCanceledV1
      title: Transfer Canceled v1
      summary: Notifica que una transferencia fue cancelada.
      contentType: application/json
      payload:
        $ref: "#/components/schemas/TransferCanceledDataV1"
        example:
          eventId: "abababab-cdcd-efef-0101-232323232323"
          eventType: "TransferCanceled"
          occurredAt: "2025-09-22T10:12:00Z"
          emittedAt: "2025-09-22T10:12:01Z"
          sourceModule: "CORE"
          tenant: { campusId: "AR", orgId: "FIN" }
          actor: { userId: "system", role: "SERVICE" }
          version: "1.0"
          payload:
            transfer_uuid: "9999aaaa-bbbb-cccc-dddd-eeeeeeeeeeee"
            from_wallet_uuid: "11111111-2222-3333-4444-555555555555"
            to_wallet_uuid: "66666666-7777-8888-9999-000000000000"
            amount: "500.00"
            currency: "ARS"
            reason: "USER_REQUEST"
            canceled_at: "2025-09-22T10:12:00Z"
            status: "CANCELED"
